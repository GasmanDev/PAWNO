#include <a_samp>
#include <vehicledata>
///var
new PlayerText:VSpeed[7];
new VSpeedTimer[MAX_PLAYERS];
//forwrad
forward VSpeedUpdate(playerid);
////////////////////////////////
public OnFilterScriptInit()
{
	print("\n--------------------------------------");
	print("				V-Speedo Loaded");
	print("--------------------------------------\n");
	return 1;
}

public OnFilterScriptExit()
{
	return 1;
}

public OnPlayerUpdate(playerid)
{
	return 1;
}
public OnPlayerStateChange(playerid, newstate, oldstate)
{
    if(oldstate == PLAYER_STATE_ONFOOT && newstate == PLAYER_STATE_DRIVER) 
    {
    ShowVSpeed(playerid);
	}
	if(oldstate == PLAYER_STATE_DRIVER && newstate == PLAYER_STATE_ONFOOT) 
    {
    HideVSpeed(playerid);
	}
	return 1;
}
public VSpeedUpdate(playerid)
{
	new string[128];
	format(string,sizeof(string),"%d Km/h",GetVehicleSpeed(GetPlayerVehicleID(playerid)));
	PlayerTextDrawSetString(playerid,VSpeed[4],string);
	PlayerTextDrawShow(playerid,VSpeed[4]);
	new Float:speed = (GetVehicleSpeed(GetPlayerVehicleID(playerid))*106)/GetVehicleTopSpeed(GetPlayerVehicleID(playerid));
	PlayerTextDrawTextSize(playerid,VSpeed[3],speed+498, 0.000000);
	if(speed+498 > 604)
	{
	PlayerTextDrawTextSize(playerid,VSpeed[3],604.0, 0.000000);
	}
	PlayerTextDrawShow(playerid,VSpeed[3]);
	return 1;
}
public OnPlayerConnect(playerid)
{
	VSpeed[0] = CreatePlayerTextDraw(playerid,500.000000, 400.000000, "_");
	PlayerTextDrawBackgroundColor(playerid,VSpeed[0], 255);
	PlayerTextDrawFont(playerid,VSpeed[0], 1);
	PlayerTextDrawLetterSize(playerid,VSpeed[0], 0.500000, 3.699997);
	PlayerTextDrawColor(playerid,VSpeed[0], -1);
	PlayerTextDrawSetOutline(playerid,VSpeed[0], 0);
	PlayerTextDrawSetProportional(playerid,VSpeed[0], 1);
	PlayerTextDrawSetShadow(playerid,VSpeed[0], 1);
	PlayerTextDrawUseBox(playerid,VSpeed[0], 1);
	PlayerTextDrawBoxColor(playerid,VSpeed[0], 170);
	PlayerTextDrawTextSize(playerid,VSpeed[0], 605.000000, 0.000000);
	PlayerTextDrawSetSelectable(playerid,VSpeed[0], 0);

	VSpeed[1] = CreatePlayerTextDraw(playerid,501.000000, 429.000000, "_");
	PlayerTextDrawBackgroundColor(playerid,VSpeed[1], 255);
	PlayerTextDrawFont(playerid,VSpeed[1], 1);
	PlayerTextDrawLetterSize(playerid,VSpeed[1], 0.500000, 0.299999);
	PlayerTextDrawColor(playerid,VSpeed[1], -1);
	PlayerTextDrawSetOutline(playerid,VSpeed[1], 0);
	PlayerTextDrawSetProportional(playerid,VSpeed[1], 1);
	PlayerTextDrawSetShadow(playerid,VSpeed[1], 1);
	PlayerTextDrawUseBox(playerid,VSpeed[1], 1);
	PlayerTextDrawBoxColor(playerid,VSpeed[1], 16711935);
	PlayerTextDrawTextSize(playerid,VSpeed[1], 604.000000, -2.000000);
	PlayerTextDrawSetSelectable(playerid,VSpeed[1], 0);

	VSpeed[2] = CreatePlayerTextDraw(playerid,501.000000, 401.000000, "_");
	PlayerTextDrawBackgroundColor(playerid,VSpeed[2], 255);
	PlayerTextDrawFont(playerid,VSpeed[2], 1);
	PlayerTextDrawLetterSize(playerid,VSpeed[2], 0.500000, -0.000000);
	PlayerTextDrawColor(playerid,VSpeed[2], -1);
	PlayerTextDrawSetOutline(playerid,VSpeed[2], 0);
	PlayerTextDrawSetProportional(playerid,VSpeed[2], 1);
	PlayerTextDrawSetShadow(playerid,VSpeed[2], 1);
	PlayerTextDrawUseBox(playerid,VSpeed[2], 1);
	PlayerTextDrawBoxColor(playerid,VSpeed[2], 16711935);
	PlayerTextDrawTextSize(playerid,VSpeed[2], 604.000000, -2.000000);
	PlayerTextDrawSetSelectable(playerid,VSpeed[2], 0);

	VSpeed[3] = CreatePlayerTextDraw(playerid,501.000000, 407.000000, "_");
	PlayerTextDrawBackgroundColor(playerid,VSpeed[3], 16711935);
	PlayerTextDrawFont(playerid,VSpeed[3], 1);
	PlayerTextDrawLetterSize(playerid,VSpeed[3], 0.500000, 1.799999);
	PlayerTextDrawColor(playerid,VSpeed[3], -1);
	PlayerTextDrawSetOutline(playerid,VSpeed[3], 1);
	PlayerTextDrawSetProportional(playerid,VSpeed[3], 1);
	PlayerTextDrawUseBox(playerid,VSpeed[3], 1);
	PlayerTextDrawBoxColor(playerid,VSpeed[3], 16711935);
	PlayerTextDrawTextSize(playerid,VSpeed[3], 498.000000, 0.000000);
	PlayerTextDrawSetSelectable(playerid,VSpeed[3], 0);

	VSpeed[4] = CreatePlayerTextDraw(playerid,528.000000, 410.000000, "0 Km/H");
	PlayerTextDrawBackgroundColor(playerid,VSpeed[4], 16711935);
	PlayerTextDrawFont(playerid,VSpeed[4], 3);
	PlayerTextDrawLetterSize(playerid,VSpeed[4], 0.310000, 1.000000);
	PlayerTextDrawColor(playerid,VSpeed[4], 255);
	PlayerTextDrawSetOutline(playerid,VSpeed[4], 1);
	PlayerTextDrawSetProportional(playerid,VSpeed[4], 1);
	PlayerTextDrawSetSelectable(playerid,VSpeed[4], 0);

	VSpeed[5] = CreatePlayerTextDraw(playerid,528.000000, 427.000000, "V-Speedo");
	PlayerTextDrawBackgroundColor(playerid,VSpeed[5], 16711935);
	PlayerTextDrawFont(playerid,VSpeed[5], 2);
	PlayerTextDrawLetterSize(playerid,VSpeed[5], 0.240000, 0.799999);
	PlayerTextDrawColor(playerid,VSpeed[5], 170);
	PlayerTextDrawSetOutline(playerid,VSpeed[5], 0);
	PlayerTextDrawSetProportional(playerid,VSpeed[5], 1);
	PlayerTextDrawSetShadow(playerid,VSpeed[5], 1);
	PlayerTextDrawSetSelectable(playerid,VSpeed[5], 0);

	VSpeed[6] = CreatePlayerTextDraw(playerid,498.000000, 387.000000, "sa-mp.com");
	PlayerTextDrawBackgroundColor(playerid,VSpeed[6], 0);
	PlayerTextDrawFont(playerid,VSpeed[6], 0);
	PlayerTextDrawLetterSize(playerid,VSpeed[6], 0.500000, 1.000000);
	PlayerTextDrawColor(playerid,VSpeed[6], 170);
	PlayerTextDrawSetOutline(playerid,VSpeed[6], 0);
	PlayerTextDrawSetProportional(playerid,VSpeed[6], 1);
	PlayerTextDrawSetShadow(playerid,VSpeed[6], 1);
	PlayerTextDrawSetSelectable(playerid,VSpeed[6], 0);
	return 1;
}
///////STOCK

stock GetVehicleSpeed( vehicleid )
{
    new
        Float:x,
        Float:y,
        Float:z,
        vel;

    GetVehicleVelocity( vehicleid, x, y, z );
    vel = floatround( floatsqroot( x*x + y*y + z*z ) * 180 );
    return vel;
}
stock ShowVSpeed(playerid)
{
	for(new i =0;i<7;i++)
	{
	PlayerTextDrawShow(playerid,VSpeed[i]);
	}
	VSpeedTimer[playerid] = SetTimerEx("VSpeedUpdate",250,1,"i",playerid);
	return 1;
}
stock HideVSpeed(playerid)
{
    PlayerTextDrawSetString(playerid,VSpeed[4],"0 Km/h");
    PlayerTextDrawTextSize(playerid,VSpeed[3], 498.000000, 0.000000);
    for(new i =0;i<7;i++)
	{
	PlayerTextDrawHide(playerid,VSpeed[i]);
	}
	KillTimer(VSpeedTimer[playerid]);
	return 1;
}
